---
layout: post
title: A Critique of Code Memes
---

_The examples here are written in Elm, the original language of the `RemoteData` 
pattern. Like the pattern itself, the thinking can be generalized to other 
languages._

# I. Code memes

Code memes are units of thought spread through the discourse of programmers by 
rigid imitation.
Each of these units is a readymade response to a shared experience.
The shared experience tends to be problem solving.
Perhaps the most well-known code meme is the "Hello World" program.
"Hello World" is a response to the experience of writing a program in a new 
language for the first time.
The problem is "What program should I write?" and the readymade response is the
"Hello World" program.

Rigid imitation across contexts is what makes memes more specific than shared 
understanding in general.
Not every use of a programming pattern is mimetic.
The application of some patterns involves significant adaptation of the pattern
to the problem.
The pattern informs but does not dictate the result.

## II. What is RemoteData?

The code meme _Slaying a UI Antipattern in X_ refers to the 
`RemoteData` pattern for modeling data generated by a REST request. 
<sup><a href="#1">1</a>,</sup>
<sup><a href="#2">2</a>,</sup>
<sup><a href="#3">3</a>,</sup>
<sup><a href="#4">4</a>,</sup>
<sup><a href="#5">5</a></sup>
User interfaces generally present this kind of data, "remote data", in one of 
four states: not loaded, loading, error, and success.
It's common for UI programmers to derive these states from a model with this
shape: 

```elm
type alias Model = 
  { xs : List x
  , isLoading : Bool
  , error : String
  }
```

`RemoteData` improves on this approach by encoding the state of the data 
into the data's type:

```elm
type alias Model = 
    { xs : RemoteData
    }

type RemoteData 
    = NotAsked
    | Loading
    | Failure e
    | Success (List x)
```

Making the state explicit has two benefits. 
First, the state is universally consistent and clear.
There is no risk that a developer will incorrectly derive an implicit state.
Second, consumers of the data are required to handle every state:

```elm
view : Model -> Html a
view { xs } =
    case xs of
        NotAsked ->
            --... 
        Loading ->
            --... 
        Failure error ->
            --... 
        Success data ->
            --... 
```

This code will not compile unless the patterns of the case statement cover 
every possible state.
The result is a system that is robust by default.

## III. How is RemoteData insufficient?

`RemoteData` insufficiently models the domain of remote data.
Imagine an application that displays a list of "foos".
The first request is to `/api/foos`.
This returns a list of foos each in an abbreviated form.
The application correctly sets `model.foos` first to `NotAsked`, then
to `Loading`, and finally to `Success (List Foo)`.
Meanwhile, the user interface transitions from an empty screen to a loading 
screen to a list of foos.

All is well until the user clicks on one foo in the list.
Now the list should show additional details about the clicked foo.
But some of those details aren't available. 
The app only loaded abbreviated foos.
So a loading indicator should appear next to that foo's place in the list while 
more data is loaded from `/api/foos/[id]`.
What actually happens is that the app jumps back to the first loading screen.
Then the list of foos is shortened to a list of one foo with details.
To see the complete list, the user must refresh the page.

The problem is loss of context.
When the user clicks into the detail view, a request is started and `model.foos`
is correctly set to `Loading`.
But there is only one `Loading` state, the same `Loading` state for which the 
`view` function renders the first loading screen. 
The app jumps back to the first loading screen because it cannot distinguish
between loading the foos collection and loading foo details.
Then the request for foo details is complete and `model.foos` is again set to 
`Success (List Foo)`.
But the request for details returns a single foo, so `model.foos` is now a list
of one.
There is no way to keep data that has already loaded during the foos collection 
request.
`RemoteData` is insufficient because it attempts to model a _stateful_ cache 
of data in terms of a _stateless_ transfer of data, REST.

## III.

<!--
The power of union types is well-demonstrated by the `RemoteData` pattern.
-->

```
+-------------------------------+
| Empty Pending                 |<-+-----+-----+
+-------------------------------+  |     |     |
                                   |     |     |
Pending----------------------------+     |     |
Success------------------------------+   |     |
Error----------------------------------+ |     |
                                     | | |     |
                                     | | |     |
+-------------------------------+    | | |     |
| Empty Valid                   |    | | |     |
+-------------------------------+    | | |     |
                                     | | |     |
Pending----------------------------------+     |
Success------------------------------------+   |
Error----------------------------------------+ |
                                     | |   | | |
                                     | |   | | | 
+-------------------------------+    | |   | | |
| Empty (Invalid e)             |<-----+-----+-----+
+-------------------------------+    |     |   |   |
                                     |     |   |   |
Pending----------------------------------------+   |
Success------------------------------------------+ |
Error----------------------------------------------+
                                     |     |     |
                                     |     |     |
+-------------------------------+    |     |     |
| Primed Pending Collection     |<---------------|---+-----+-----+
+-------------------------------+    |     |     |   |     |     |
                                     |     |     |   |     |     |
Pending----------------------------------------------+     |     |
Success------------------------------------------------+   |     |
Error----------------------------------------------------+ |     |
                                     |     |     |     | | |     |
                                     |     |     |     | | |     |
+-------------------------------+    |     |     |     | | |     | 
| Primed (Valid d) Collection   |<---+-----+-----+-----+-|-|-+---|-+
+-------------------------------+                        | | |   | |
                                                         | | |   | |
Pending----------------------------------------------------+ |   | |
Success------------------------------------------------------+   | |
Error----------------------------------------------------------+ | |
                                                         |     | | |
                                                         |     | | |
+-------------------------------+                        |     | | |
| Primed (Invalid e) Collection |<-----------------------+-----+-|-|-+
+-------------------------------+                                | | |
                                                                 | | |
Pending----------------------------------------------------------+ | |
Success------------------------------------------------------------+ |
Error----------------------------------------------------------------+
```


**Footnotes**

<ol>
  <li>
    <fn id="1">
      <a href="http://blog.jenkster.com/2016/06/how-elm-slays-a-ui-antipattern.html">
        How Elm Slays a UI Antipattern
      </a>
      by Kris Jenkins, the first to describe this pattern.
    </fn>
  </li>
  <li>
    <fn id="2">
      <a href="https://medium.com/javascript-inside/slaying-a-ui-antipattern-in-fantasyland-907cbc322d2a">
        Slaying a UI Antipattern in Fantasyland
      </a>
    </fn>
  </li>
  <li>
    <fn id="3">
      <a href="https://medium.com/javascript-inside/slaying-a-ui-antipattern-in-react-64a3b98242c">
        Slaying a UI Antipattern in React
      </a>
    </fn>
  </li>
  <li>
    <fn id="4">
      <a href="https://medium.com/@gcanti/slaying-a-ui-antipattern-with-flow-5eed0cfb627b">
        Slaying a UI Antipattern in Flow
      </a>
    </fn>
  </li>
  <li>
    <fn id="5">
      <a href="https://gist.github.com/busypeoples/b8982f215642e5258d3d49a9aa7d7438">
        Slaying a UI Antipattern in ReasonML
      </a>
    </fn>
  </li>
</ol>
